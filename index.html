
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Control de Negocio</title>
  <style>
    body { font-family: sans-serif; text-align: center; background: #f9f9f9; margin: 0; padding: 20px; }
    button { padding: 10px 20px; margin: 10px; font-size: 1em; }
    .hidden { display: none; }
    input, select { padding: 10px; margin: 5px; width: 90%; max-width: 300px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; }
  </style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>


<link rel="manifest" href="manifest.json">
<script>
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("service-worker.js");
  }
</script>
</head>
<body>

<h1>Control de Ventas y Gastos</h1>

<div id="inicio">
  <button onclick="mostrarTodasLasTablas()">Ver todas las tablas</button>
  <button onclick="mostrarSubmenu('gasto')">Gasto</button>
  <button onclick="mostrarSubmenu('venta')">Venta</button>
</div>

<!-- Submenús -->
<div id="submenu-gasto" class="hidden">
  <button onclick="abrirFormularioGasto('Envío')">Envío</button>
  <button onclick="abrirFormularioGasto('Insumo')">Insumo</button>
  <button onclick="abrirFormularioGasto('Impresiones')">Impresiones</button>
  <button onclick="abrirFormularioGasto('Luces')">Luces</button>
</div>

<div id="submenu-venta" class="hidden">
  <button onclick="abrirFormularioVenta('neon')">Neón Fusión</button>
  <button onclick="abrirFormularioVenta('mari')">MARI</button>
  <button onclick="abrirFormularioVenta('chino')">Chino</button>
</div>

<!-- Formularios -->
<div id="formularioGasto" class="hidden">
  <h3 id="gastoTipo"></h3>
  <input type="number" id="totalGasto" placeholder="Total ($)">
  <button onclick="agregarGasto()">Guardar Gasto</button>
</div>

<div id="formularioVenta" class="hidden">
  <h3 id="ventaTabla"></h3>
  <input type="date" id="fechaVenta">
  <input type="text" id="clienteVenta" placeholder="Cliente">
  <input type="text" id="productoVenta" placeholder="Producto">
  <input type="text" id="medidaVenta" placeholder="Medida">
  <input type="text" id="luzVenta" placeholder="Luz (Sí/No)">
  <input type="text" id="resinaVenta" placeholder="Resina (Sí/No)">
  <input type="number" id="costoVenta" placeholder="Costo">
  <input type="number" id="cantidadVenta" placeholder="Cantidad">
  <button onclick="agregarVenta()">Guardar Venta</button>
</div>

<!-- Tablas -->
<div id="tablaGastos" class="hidden">

    <button onclick="exportarCSV('tablaGastos')">Exportar a Excel</button>
    <button onclick="exportarPDF('tablaGastos')">Exportar a PDF</button>
    
  <h2>Tabla de Gastos</h2>
  <table><thead><tr><th>Tipo</th><th>Total</th><th>Eliminar</th></tr></thead><tbody></tbody></table>
</div>

<div id="tabla-neon" class="hidden">

    <button onclick="exportarCSV('tabla-neon')">Exportar a Excel</button>
    <button onclick="exportarPDF('tabla-neon')">Exportar a PDF</button>
    
  <h2>Ventas - Neón Fusión</h2>
  <table><thead><tr><th>Fecha</th><th>Cliente</th><th>Producto</th><th>Medida</th><th>Luz</th><th>Resina</th><th>Costo</th><th>Cantidad</th><th>Total</th><th>Eliminar</th></tr></thead><tbody></tbody></table>
</div>

<div id="tabla-mari" class="hidden">

    <button onclick="exportarCSV('tabla-mari')">Exportar a Excel</button>
    <button onclick="exportarPDF('tabla-mari')">Exportar a PDF</button>
    
  <h2>Ventas - MARI</h2>
  <table><thead><tr><th>Fecha</th><th>Cliente</th><th>Producto</th><th>Medida</th><th>Luz</th><th>Resina</th><th>Costo</th><th>Cantidad</th><th>Total</th><th>Eliminar</th></tr></thead><tbody></tbody></table>
</div>

<div id="tabla-chino" class="hidden">

    <button onclick="exportarCSV('tabla-chino')">Exportar a Excel</button>
    <button onclick="exportarPDF('tabla-chino')">Exportar a PDF</button>
    
  <h2>Ventas - Chino</h2>
  <table><thead><tr><th>Fecha</th><th>Cliente</th><th>Producto</th><th>Medida</th><th>Luz</th><th>Resina</th><th>Costo</th><th>Cantidad</th><th>Total</th><th>Eliminar</th></tr></thead><tbody></tbody></table>
</div>

<script>
let gastoTipoActivo = '';
let ventaTablaActiva = '';

function mostrarSubmenu(tipo) {
  document.getElementById('submenu-gasto').classList.add('hidden');
  document.getElementById('submenu-venta').classList.add('hidden');
  document.getElementById('formularioGasto').classList.add('hidden');
  document.getElementById('formularioVenta').classList.add('hidden');
  if (tipo === 'gasto') {
    document.getElementById('submenu-gasto').classList.remove('hidden');
  } else {
    document.getElementById('submenu-venta').classList.remove('hidden');
  }
}

function abrirFormularioGasto(tipo) {
  gastoTipoActivo = tipo;
  document.getElementById('gastoTipo').textContent = "Registrar gasto por: " + tipo;
  document.getElementById('formularioGasto').classList.remove('hidden');
}

function abrirFormularioVenta(tabla) {
  ventaTablaActiva = tabla;
  document.getElementById('ventaTabla').textContent = "Registrar venta para: " + tabla;
  document.getElementById('formularioVenta').classList.remove('hidden');
}

function agregarGasto() {
  const total = document.getElementById('totalGasto').value;
  const fila = `<tr><td>${gastoTipoActivo}</td><td>$${total}</td><td><button onclick="eliminarFila(this, 'tablaGastos')">Eliminar</button></td></tr>`;
  document.querySelector('#tablaGastos tbody').insertAdjacentHTML('beforeend', fila);
  document.getElementById('tablaGastos').classList.remove('hidden');
  guardarTabla('tablaGastos');
}

function agregarVenta() {
  const f = document.getElementById('fechaVenta').value;
  const cli = document.getElementById('clienteVenta').value;
  const prod = document.getElementById('productoVenta').value;
  const med = document.getElementById('medidaVenta').value;
  const luz = document.getElementById('luzVenta').value;
  const resina = document.getElementById('resinaVenta').value;
  const cost = parseFloat(document.getElementById('costoVenta').value);
  const cant = parseFloat(document.getElementById('cantidadVenta').value);
  const total = cost * cant;

  const id = 'tabla-' + ventaTablaActiva;
  const fila = `<tr><td>${f}</td><td>${cli}</td><td>${prod}</td><td>${med}</td><td>${luz}</td><td>${resina}</td><td>${cost}</td><td>${cant}</td><td>${total}</td>
  <td><button onclick="eliminarFila(this, '${id}')">Eliminar</button></td></tr>`;

  document.querySelector('#' + id + ' tbody').insertAdjacentHTML('beforeend', fila);
  document.getElementById(id).classList.remove('hidden');
  guardarTabla(id);
}

function eliminarFila(btn, id) {
  btn.closest('tr').remove();
  guardarTabla(id);
}

function guardarTabla(id) {
  const rows = Array.from(document.querySelectorAll(`#${id} tbody tr`)).map(tr =>
    Array.from(tr.querySelectorAll('td')).slice(0, -1).map(td => td.textContent)
  );
  localStorage.setItem(id, JSON.stringify(rows));
}

function cargarTablas() {
  ['tablaGastos', 'tabla-neon', 'tabla-mari', 'tabla-chino'].forEach(id => {
    const data = JSON.parse(localStorage.getItem(id) || '[]');
    data.forEach(row => {
      const fila = '<tr>' + row.map(cell => `<td>${cell}</td>`).join('') +
        `<td><button onclick="eliminarFila(this, '${id}')">Eliminar</button></td></tr>`;
      document.querySelector(`#${id} tbody`).insertAdjacentHTML('beforeend', fila);
      document.getElementById(id).classList.remove('hidden');
    });
  });
}

function mostrarTodasLasTablas() {
  ['tablaGastos', 'tabla-neon', 'tabla-mari', 'tabla-chino'].forEach(id => {
    document.getElementById(id).classList.remove('hidden');
  });
}

window.onload = cargarTablas;
</script>

<script>
function exportarCSV(tableId) {
  const rows = Array.from(document.querySelectorAll(`#${tableId} table tr`)).map(row =>
    Array.from(row.querySelectorAll('th, td')).map(cell => `"${cell.innerText}"`).join(',')
  );
  const csvContent = "data:text/csv;charset=utf-8," + rows.join("\n");
  const encodedUri = encodeURI(csvContent);
  const link = document.createElement("a");
  link.setAttribute("href", encodedUri);
  link.setAttribute("download", tableId + ".csv");
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}

function exportarPDF(tableId) {
  const element = document.querySelector(`#${tableId}`);
  html2canvas(element).then(canvas => {
    const imgData = canvas.toDataURL("image/png");
    const pdf = new jspdf.jsPDF("p", "mm", "a4");
    const width = pdf.internal.pageSize.getWidth();
    const height = canvas.height * width / canvas.width;
    pdf.addImage(imgData, 'PNG', 0, 10, width, height);
    pdf.save(`${tableId}.pdf`);
  });
}
</script>

</body>
</html>
